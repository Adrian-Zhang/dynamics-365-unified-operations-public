---
# required metadata

title: Generate QR codes and print them on receipts for Saudi Arabia
description: This topic provides an overview of the functionality for printing QR codes that is available for Saudi Arabia in Microsoft Dynamics 365 Commerce.
author: EvgenyPopovMBS
manager: annbe
ms.date: 11/24/2021
ms.topic: article
ms.prod: 
ms.technology: 

# optional metadata

# ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Developer
# ms.devlang: 
ms.reviewer: v-chgri
# ms.tgt_pltfrm: 
# ms.custom: 
ms.search.region: Saudi Arabia
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2021-11-04
ms.dyn365.ops.version: 10.0.21

---
# Generate QR codes and print them on receipts for Saudi Arabia

[!include[banner](../includes/banner.md)]

This topic provides an overview of the functionality for printing QR codes that is available for Saudi Arabia in Microsoft Dynamics 365 Commerce.

In a store that is linked to a legal entity that has its primary address in Saudi Arabia, users can print a QR code on the receipt for a cash-and-carry or customer order sales transaction. The QR code contains the following information.

| Sequence | Field                                                    | Data source |
|----------| ---------------------------------------------------------|-------------|
| 1        | Company name                                             | The name of the legal entity |
| 2        | Company VAT registration number                          | The tax registration number of the legal entity |
| 3        | Date and time of transaction                             | The date and time of the retail store transaction |
| 4        | Total receipt amount (including value-added tax \[VAT\]) | The total amount of the retail store transaction |
| 5        | Total amount of VAT included in receipt                  | The total tax amount of the retail store transaction |

> [!NOTE]
> When customer order transactions are created, the total receipt amount is calculated by adding the total amounts of all transaction lines that use the carry-out delivery mode.

The QR code is generated by applying the base64 transformation to the transaction information encoded in the Tag-Length-Value (TLV) format. Zakat, Tax and Customs Authority (ZATCA) provides tools that can be used to validate the QR code. For more information about the electronic invoicing requirements and QR code validation capabilities, see [E-Invoicing portal by ZATCA](https://zatca.gov.sa/en/E-Invoicing/Pages/default.aspx).

## Set up QR codes

To generate QR codes and print them on receipts for Saudi Arabia, you must complete the following tasks.

1. Configure custom fields so that they can be used in receipt formats for sales receipts.
1. Configure receipt formats.
1. Specify QR code dimensions in Commerce parameters.
1. Enable Commerce runtime (CRT) extensions.

### Configure custom fields so that they can be used in receipt formats for sales receipts

You can configure the language text and custom fields that are used in the point of sale (POS) receipt formats. On the **Language text** page, add the following records for the labels of the custom fields for receipt layouts. Note that the **Language ID**, **Text ID**, and **Text** values that are shown in the table are just examples. You can change them to meet your requirements. However, the **Text ID** values that you use must be unique, and they must be equal to or higher than 900001.

| Language ID | Text ID | Text         |
|-------------|---------|--------------|
| en-US       | 900001  | QR code (SA) |

> [!NOTE]
> The default company of the user who creates the receipt setup should be the same legal entity where the language text setup is created. Alternatively, the same language texts should be created in both the user's default company and the legal entity of the store that the setup is created for.

On the **Custom fields** page, add the following records for the custom fields for receipt layouts. Note that **Caption text ID** values must correspond to the **Text ID** values that you specified on the **Language text** page.

| Name             | Type    | Caption text ID |
|------------------|---------|-----------------|
| INVOICEQRCODE_SA | Receipt | 900001          |

### Configure receipt formats

For every required receipt format, change the value of the **Print behavior** field to **Always print**.

In the receipt format designer, add the following custom field to the **Footer** section of the receipt. Note that field names correspond to the language texts that you defined in the previous section.

- **QR code (SA)** â€“ This field prints the QR code on the receipt.

For more information about how to work with receipt formats, see [Set up and design receipt formats](../receipt-templates-printing.md).

### Specify QR code dimensions in Commerce parameters

On the **Configuration parameters** tab of the Commerce parameters page, add the following configuration parameters:

- **QrCodeWidth** - The width of the QR code image, in pixels. Specify an appropriate value for the parameter.
- **QrCodeHeight** - The height of the QR code image, in pixels. Specify an appropriate value for the parameter.

> [!NOTE]
> It is mandatory to specify the values of these configuration parameters to print QR codes in receipts. Support for default values of the parameters may be added in future updates.

### Enable CRT extensions

> [!WARNING]
> Because of limitations of the [new independent packaging and extension model](../dev-itpro/build-pipeline.md), it can't currently be used with this localization functionality. You must use the previous version of the Retail software development kit (SDK) on a developer virtual machine (VM) in Microsoft Dynamics Lifecycle Services (LCS). (Microsoft plans to add support for localization functionality to the new independent packaging and extension model in later versions.)

#### Development environment

Follow these steps to set up a development environment so that you can test and extend the localization functionality.

1. Find the extension configuration file for CRT:

    - **Retail Server:** The file is named **commerceruntime.ext.config**, and it can be found in the **bin\\ext** folder under the Internet Information Services (IIS) Retail Server site location.
    - **Local CRT on Modern POS:** The file is named **CommerceRuntime.MPOSOffline.Ext.config**, and it can be found under the local CRT client broker location.

1. Register the CRT change in the extension configuration file, as shown in the following example.

    ``` xml
    <add source="assembly" value="Microsoft.Dynamics.Commerce.Runtime.ReceiptsSaudiArabia" />
    <add source="assembly" value="Microsoft.Dynamics.Commerce.Runtime.ElectronicReporting" />
    ```

#### Production environment

Follow these steps to create deployable packages that contain Commerce components, and to apply those packages in a production environment.

1. In the **commerceruntime.ext.config** and **CommerceRuntime.MPOSOffline.Ext.config** package configuration files under the **RetailSdk\\Assets** folder, add the following lines to the **composition** section.

    ``` xml	
    <add source="assembly" value="Microsoft.Dynamics.Commerce.Runtime.ReceiptsSaudiArabia" />
    <add source="assembly" value="Microsoft.Dynamics.Commerce.Runtime.ElectronicReporting" />
    ```

1. Open the MSBuild Command Prompt for Visual Studio utility and run **msbuild** under the Retail SDK folder to create deployable packages.
1. Apply the packages via LCS or manually. For more information, see [Create deployable packages](../dev-itpro/retail-sdk/retail-sdk-packaging.md).
